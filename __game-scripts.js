var Follow=pc.createScript("follow");Follow.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),Follow.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),Follow.prototype.initialize=function(){this.vec=new pc.Vec3},Follow.prototype.update=function(t){if(this.target){var e=this.target.getPosition();e.x+=.75*this.distance,e.y+=1*this.distance,e.z+=.75*this.distance,this.vec.lerp(this.vec,e,.1),this.entity.setPosition(this.vec)}};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3},Movement.prototype.update=function(e){var t=0,s=0;if(this.app.keyboard.isPressed(pc.KEY_LEFT)&&(t=-this.speed),this.app.keyboard.isPressed(pc.KEY_RIGHT)&&(t+=this.speed),this.app.keyboard.isPressed(pc.KEY_UP)&&(s=-this.speed),this.app.keyboard.isPressed(pc.KEY_DOWN)&&(s+=this.speed),this.force.x=t,this.force.z=s,this.force.length()){var i=Math.cos(.25*-Math.PI),o=Math.sin(.25*-Math.PI);this.force.set(this.force.x*i-this.force.z*o,0,this.force.z*i+this.force.x*o),this.force.length()>this.speed&&this.force.normalize().scale(this.speed)}this.entity.rigidbody.applyImpulse(this.force)};var Teleportable=pc.createScript("teleportable");Teleportable.prototype.initialize=function(){this.lastTeleportFrom=null,this.lastTeleportTo=null,this.lastTeleport=Date.now(),this.startPosition=this.entity.getPosition().clone()},Teleportable.prototype.update=function(t){this.entity.getPosition().y<0&&this.teleport(this.lastTeleportFrom,this.lastTeleportTo)},Teleportable.prototype.teleport=function(t,e){var o;t&&Date.now()-this.lastTeleport<500||(this.lastTeleport=Date.now(),this.lastTeleportFrom=t,this.lastTeleportTo=e,e?(o=e.getPosition()).y+=.5:o=this.startPosition,this.entity.rigidbody.teleport(o),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO)};var Teleport=pc.createScript("teleport");Teleport.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleport.prototype.initialize=function(){this.target&&this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Teleport.prototype.onTriggerEnter=function(t){t.script.teleportable&&t.script.teleportable.teleport(this.entity,this.target)};var ButtonScript1=pc.createScript("buttonScript");ButtonScript1.attributes.add("popupScreen",{type:"entity"}),ButtonScript1.prototype.initialize=function(){this.entity.element.on("click",this.onClick,this),this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mouseleave",this.onLeave,this),this.popupScreen&&(this.popupScreen.enabled=!1)},ButtonScript1.prototype.onClick=function(t){this.popupScreen&&(this.popupScreen.enabled=!0)},ButtonScript1.prototype.onEnter=function(t){console.log("Mouse entered button area")},ButtonScript1.prototype.onLeave=function(t){console.log("Mouse left button area")};var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.prototype.initialize=function(){},PlayerMovement.prototype.update=function(e){};var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3,this.app.mouse.on("mousemove",this._onMouseMove,this),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,s=this.app,o=this.camera.forward,i=this.camera.right,r=0,n=0;(s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_Q))&&(r-=i.x,n-=i.z),s.keyboard.isPressed(pc.KEY_D)&&(r+=i.x,n+=i.z),s.keyboard.isPressed(pc.KEY_W)&&(r+=o.x,n+=o.z),s.keyboard.isPressed(pc.KEY_S)&&(r-=o.x,n-=o.z),0===r&&0===n||(t.set(r,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var AssignMaterialImageElement=pc.createScript("assignMaterialImageElement");AssignMaterialImageElement.attributes.add("materialAsset",{type:"asset"}),AssignMaterialImageElement.prototype.initialize=function(){this.entity.element.material=this.materialAsset.resource};var WorldSpaceImageButton=pc.createScript("worldSpaceImageButton");WorldSpaceImageButton.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this)},WorldSpaceImageButton.prototype.update=function(o){},WorldSpaceImageButton.prototype.onMouseDown=function(o){var t=this.app.root.findByName("Camera");if(t&&t.camera){var e=t.getPosition(),a=t.camera.screenToWorld(o.x,o.y,t.camera.farClip),n=this.app.systems.rigidbody.raycastFirst(e,a);n&&n.entity===this.entity&&this.onClick()}else console.error("Camera entity or camera component not found")},WorldSpaceImageButton.prototype.onClick=function(){console.log("Image Button clicked")};var ToggleOverlay=pc.createScript("toggleOverlay");ToggleOverlay.attributes.add("overlayUI",{type:"entity"}),ToggleOverlay.prototype.initialize=function(){this.entity.element.on("click",this.onClick,this),this.overlayUI.enabled=!1},ToggleOverlay.prototype.onClick=function(e){this.overlayUI.enabled=!this.overlayUI.enabled};/*!
 * 
 * Branch: main
 * Commit: be43e5357932149e71acc0193de5832769f2839b
 * User: {"name":"Kirill Osipov","email":"querielo@protonmail.com"}
 * Date: 2023-05-20T10:18:24.252Z
 *
 * MIT License
 *
 * Copyright (c) 2023 Kirill Osipov
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 *
 */
(()=>{"use strict";var e={830:function(e,t,r){var i=this&&this.__decorate||function(e,t,r,i){var s,o=arguments.length,n=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(o<3?s(n):o>3?s(t,r,n):s(t,r))||n);return o>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.BlurImageElement=void 0;const s=r(78),o=r(588),n=r(816);let a=class BlurImageElement extends pc.ScriptType{constructor(){super(...arguments),this.iterations=8,this.radiusFactor=1,this.update=(()=>{const e=new pc.Vec4;return()=>{const t=this.entity.element;if(!this.blur)return;const r=this.blur.getBlurTexture(),i=this.app.graphicsDevice;if(t){const s=t.screenCorners[0].y,o=t.screenCorners[2].y,n=t.screenCorners[0].x,a=t.screenCorners[1].x;e.set(n/i.width,s/i.height,(a-n)/i.width,(o-s)/i.height),t.rect=e,t.texture=r}}})()}initialize(){this.app.graphicsDevice;const e=this.camera;if(this.on("attr:iterations",((e,t)=>{var r;if(!this.camera)return;const i=o.BlurController.getInstance();null===(r=this.blur)||void 0===r||r.off("resize",this.update),i.release(this.camera,t,this.radiusFactor),this.blur=i.retain(this.camera,e,this.radiusFactor),this.blur.on("resize",this.update)})),this.on("attr:radiusFactor",((e,t)=>{var r;if(!this.camera)return;const i=o.BlurController.getInstance();null===(r=this.blur)||void 0===r||r.off(n.RESIZE_EVENT,this.update),i.release(this.camera,this.iterations,t),this.blur=i.retain(this.camera,this.iterations,e),this.blur.on("resize",this.update)})),e){const t=o.BlurController.getInstance();this.blur=t.retain(e,this.iterations,this.radiusFactor),this.blur.on("resize",this.update)}}};a=i([(0,s.createScript)({camera:{type:"entity"},iterations:{type:"number",default:8,description:"Number of blur iterations.\nHigher number means better quality but worse performance. Keep it low on mobile devices.\n"},radiusFactor:{type:"number",default:1,min:0,max:10,description:"Blur radius factor. Higher number means more blur."}})],a),t.BlurImageElement=a},588:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BlurController=void 0;const i=r(816);class BlurController{constructor(){this.confToBlur=new Map,this.freeBlur=new Set}retain(e,t,r){const s=e.camera;let o=this.confToBlur.get(s);o||(o=new Map,this.confToBlur.set(s,o));const n=`${t}:${r}`;let a=o.get(n);if(!a)if(this.freeBlur.size>0){const e=this.freeBlur.values().next().value;this.freeBlur.delete(e),a=e}else a=new i.Blur(e);return a.setIterations(t),a.setRadiusFactor(r),o.set(n,a),a.retain(),a}release(e,t,r){const i=e.camera,s=this.confToBlur.get(i);if(!s)return;const o=`${t}:${r}`,n=s.get(o);n&&(n.release(),n.isFree()&&(s.delete(o),this.freeBlur.add(n)))}static getInstance(){return this._instance||(this._instance=new BlurController)}}t.BlurController=BlurController},816:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Blur=t.RESIZE_EVENT=void 0;const i=r(763),s="\nuniform sampler2D uTexture;\n\nuniform vec2 uPixelSize;\nuniform vec2 uDirection;\n\nuniform float uAlpha;\n\nvarying vec2 vUv0;\n\nvoid main() {\n  vec4 sum = vec4( .0 );\n\n  vec2 uv = vUv0;\n  vec2 direction = uDirection * uPixelSize;\n\n  vec4 color = vec4(.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(uTexture, uv) * .2270270270;\n  color += texture2D(uTexture, uv + off1) * .3162162162;\n  color += texture2D(uTexture, uv - off1) * .3162162162;\n  color += texture2D(uTexture, uv + off2) * .0702702703;\n  color += texture2D(uTexture, uv - off2) * .0702702703;\n\n  gl_FragColor = vec4(color.xyz, uAlpha);\n}\n";t.RESIZE_EVENT="resize";class Blur extends((0,i.RefCountable)(pc.EventHandler)){constructor(e){super(),this.blurRenderTargets=[],this.width=0,this.height=0,this.iterations=10,this.factor=3;const t=e.camera;this.app=t.system.app,this.device=this.app.graphicsDevice,this.cameraEntity=e,t.requestSceneColorMap(!0),this.blankTexture=new pc.Texture(this.device,{name:"Blank Texture",format:pc.PIXELFORMAT_RGBA8,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,width:1,height:1,mipmaps:!1,levels:[new Uint8Array([0,0,0,0])]}),this.firstBlurShader=pc.createShaderFromCode(this.device,pc.PostEffect.quadVertexShader,s.split("uTexture").join("uSceneColorMap").replace("= vUv0","= vec2(vUv0.x, 1. - vUv0.y)"),"FirstBlurShader",{aPosition:pc.SEMANTIC_POSITION}),this.loopBlurShader=pc.createShaderFromCode(this.device,pc.PostEffect.quadVertexShader,s,"LoopBlurShader",{aPosition:pc.SEMANTIC_POSITION});for(let e=0;e<2;e++)this.blurRenderTargets[e]=new pc.RenderTarget({graphicsDevice:this.device,name:"Blur: Horizontal",depth:!1});this.app.on("update",this.render,this)}destroy(){var e;null===(e=this.cameraEntity.camera)||void 0===e||e.requestSceneColorMap(!1),this.firstBlurShader.destroy(),this.loopBlurShader.destroy(),this.destroyRenderTargets(),this.app.off("update",this.render,this)}setIterations(e){this.iterations=e}setRadiusFactor(e){this.factor=e}getBlurTexture(){return this.factor>0?this.blurRenderTargets[(Math.floor(this.iterations)+1)%2].colorBuffer:this.blankTexture}render(){if(this.isFree()&&this.factor>0)return;this.resize();const e=this.device,t=e.scope;t.resolve("uH").setValue(2/this.width),t.resolve("uPixelSize").setValue([1/this.width,1/this.height]);const r=t.resolve("uDirection"),i=t.resolve("uTexture"),s=t.resolve("uAlpha"),o=Math.floor(this.iterations);for(let t=0;t<o;t++){let n=(o-t)*this.factor;if(0===t)r.setValue([n,0]),pc.drawQuadWithShader(e,this.blurRenderTargets[0],this.firstBlurShader);else{const o=t%2==0?[n,0]:[0,n],a=this.blurRenderTargets[(t+1)%2].colorBuffer;r.setValue(o),i.setValue(a),s.setValue(Math.min(this.factor*this.factor*2,1)),pc.drawQuadWithShader(e,this.blurRenderTargets[t%2],this.loopBlurShader)}}}resize(){const e=this.device.width,r=this.device.height;if(e!==this.width||r!==this.height){this.width=e,this.height=r,this.destroyRenderTargets();for(let e=0;e<2;e++){const t=new pc.Texture(this.device,{name:"Blur Texture: Horizontal",format:pc.PIXELFORMAT_RGBA8,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,width:this.width,height:this.height,mipmaps:!1});this.blurRenderTargets[e]=new pc.RenderTarget({name:"Blur: Horizontal",colorBuffer:t,depth:!1})}this.fire(t.RESIZE_EVENT)}}destroyRenderTargets(){for(const e of this.blurRenderTargets)e.destroyTextureBuffers(),e.destroy()}}t.Blur=Blur},763:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RefCountable=void 0,t.RefCountable=function RefCountable(e){return class RefCounter extends e{constructor(){super(...arguments),this._count=0}get count(){return this._count}retain(){this._count++}release(){this._count--}isFree(){return 0===this._count}}}},78:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createScript=void 0,t.createScript=function(e){return function(t){const r=t.name.charAt(0).toLowerCase()+t.name.slice(1);pc.registerScript(t,r);for(const r in e)t.attributes.add(r,e[r])}}}},t={};!function __webpack_require__(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,__webpack_require__),s.exports}(830)})();